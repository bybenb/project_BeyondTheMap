# AlÃ©m do Mapa - Sistema de GestÃ£o de AgÃªncia de Viagens

Um aplicativo de desktop em **C# / Windows Forms** que gerencia reservas de viagens com autenticaÃ§Ã£o por senha **e reconhecimento facial** integrado.

---

## ğŸ“‹ VisÃ£o Geral

Este projeto Ã© um sistema completo para uma agÃªncia de viagens que permite:

- âœ… **AutenticaÃ§Ã£o de funcionÃ¡rios** (senha ou rosto)
- âœ… **Cadastro de rostos** para reconhecimento facial
- âœ… **GestÃ£o de clientes e funcionÃ¡rios** (CRUD)
- âœ… **CriaÃ§Ã£o e visualizaÃ§Ã£o de reservas** (viagens, hotÃ©is, passagens)
- âœ… **HistÃ³rico de acessos** (quem entrou e quando)
- âœ… **RelatÃ³rios em PDF**
- âœ… **Painel de administrador**



## ğŸ‘¥ Equipa & CrÃ©ditos

- **Hernani Machado** - [@bengazai](https://www.instagram.com/bengazai/)
- **NazarÃ© Sant'Ana** - [@iamnaza1](https://www.instagram.com/iamnaza1/)
- **JÃºlio Peliganga** - [@juliopelinganga](https://www.instagram.com/juliopelinganga/)
- **Jolinda Cabando**
- **David Coutinho** - [@davidcoutinho80](https://www.instagram.com/davidcoutinho80/)
- **Aldo Bruno** - [@aldo.dasilva](https://www.facebook.com/aldo.dasilva.7146/)
- **Beny Reis** - [@bkapa8](https://www.instagram.com/bkapa8/)

---


## ğŸ® Como Funciona (VisÃ£o Simples)

### 1ï¸âƒ£ **Arranque da AplicaÃ§Ã£o**
```
App inicia â†’ Tela Inicial (InicioForm)
```
O utilizador vÃª opÃ§Ãµes: Login, Cadastro, etc.

### 2ï¸âƒ£ **AutenticaÃ§Ã£o por Senha**
```
Username + Password â†’ Banco de dados valida â†’ Menu Principal
```

### 3ï¸âƒ£ **AutenticaÃ§Ã£o por Rosto** (O legal!)
```
a) PRIMEIRA VEZ: Cadastrar rosto
   CÃ¢mera liga â†’ Detecta a sua cara â†’ Guarda no banco

b) PRÃ“XIMAS VEZES: Login com rosto
   CÃ¢mera liga â†’ Compara com caras guardadas â†’ Reconhece â†’ Login automÃ¡tico
```

### 4ï¸âƒ£ **Dentro do Sistema**
- Criar reservas de viagens
- Ver histÃ³rico de reservas
- Gerar relatÃ³rios (PDF)
- Admin pode gerir tudo

---

## ğŸ” Como Funciona o Reconhecimento Facial

### **Fase 1: Treinamento (Setup)**
```
Sistema carrega todos os rostos guardados na BD
        â†“
Converte cada rosto para preto e branco (grayscale)
        â†“
Extrai padrÃµes especiais de cada rosto
(usando algoritmo LBPH - Local Binary Patterns Histograms)
        â†“
"Aprende" a reconhecer cada funcionÃ¡rio
```

### **Fase 2: Reconhecimento em Tempo Real**
```
CÃ¢mera ligada â†’ Para cada fotograma:
        â†“
1. Detecta caras (usando Haar Cascade XML)
2. Para cada cara encontrada:
   - Extrai apenas o rosto
   - Converte para preto e branco
   - Compara com rostos conhecidos
   - Calcula semelhanÃ§a (0-100)
        â†“
3. Se semelhanÃ§a < 60 â†’ "Esta Ã© a cara do JoÃ£o!"
   Se semelhanÃ§a > 60 â†’ "NÃ£o reconheÃ§o..."
```

### **Analogia FÃ¡cil**
Imagina um **guarda de seguranÃ§a** numa discoteca:
- Primeiro, memoriza as caras dos VIPs (treinamento)
- Depois, quando alguÃ©m chega, olha e diz:
  - "Hmm, 95% de certeza que Ã© o JoÃ£o" â†’ Entra!
  - "NÃ£o reconheÃ§o esta cara" â†’ Pede bilhete

---

## ğŸ› ï¸ Tecnologias Usadas

| Componente | VersÃ£o | DescriÃ§Ã£o |
|---|---|---|
| **.NET Framework** | 4.7.2 | Plataforma base |
| **Windows Forms** | Nativa | Interface grÃ¡fica |
| **MySQL** (XAMPP) | 9.5.0 | Banco de dados |
| **Emgu CV** | 4.4.0 | VisÃ£o computacional (rosto) |
| **iTextSharp** | 5.5.13 | GeraÃ§Ã£o de PDFs |
| **BouncyCastle** | 2.6.2 | Criptografia |

---

## ğŸ“ Estrutura do Projeto

```
ReservaDeViagens/
â”œâ”€â”€ Program.cs                    # Ponto de entrada (main)
â”œâ”€â”€ App.config                    # ConfiguraÃ§Ãµes
â”œâ”€â”€ ReservaDeViagens.csproj       # Arquivo do projeto
â”œâ”€â”€ packages.config               # DependÃªncias NuGet
â”‚
â”œâ”€â”€ Forms/                        # Telas da aplicaÃ§Ã£o
â”‚   â”œâ”€â”€ InicioForm.cs            # Tela inicial
â”‚   â”œâ”€â”€ LoginForm.cs             # Login por senha
â”‚   â”œâ”€â”€ LerRostoForm.cs          # Login por rosto (reconhecimento)
â”‚   â”œâ”€â”€ CadastrarRostoForm.cs    # Registar novo rosto
â”‚   â”œâ”€â”€ MenuForm.cs              # Menu principal
â”‚   â”œâ”€â”€ ViagemForm.cs            # Criar reserva
â”‚   â”œâ”€â”€ verReservaForm.cs        # Ver reservas
â”‚   â”œâ”€â”€ AdminClientForm.cs       # Gerir clientes (admin)
â”‚   â”œâ”€â”€ AdminFuncionarioForm.cs  # Gerir funcionÃ¡rios (admin)
â”‚   â”œâ”€â”€ HistoricoAcessosForm.cs  # Ver logs de acesso
â”‚   â””â”€â”€ ... (outras forms)
â”‚
â”œâ”€â”€ Resources/
â”‚   â”œâ”€â”€ haarcascade_frontalface_default.xml  # Detector de rostos (OpenCV)
â”‚   â””â”€â”€ logo/ imagens/
â”‚
â””â”€â”€ bin/
    â”œâ”€â”€ Debug/                   # CompilaÃ§Ã£o debug
    â””â”€â”€ Release/                 # CompilaÃ§Ã£o release
```

---

## ğŸš€ Como Instalar e Executar

### Requisitos PrÃ©vios

- **Visual Studio** 2017/2019/2022 (com suporte .NET Framework 4.7.2)
- **XAMPP** (versÃ£o PHP 8.2+)
- **MySQL Workbench**
- **CÃ¢mera de computador** (para reconhecimento facial)

### Passo 1: Clonar/Descarregar o Projeto

Baixe agora [Aqui](https://github.com/bybenb/project_BeyondTheMap/archive/refs/heads/master.zip) ou Clonando assim:

```bash
# Se no repositÃ³rio Git
git clone https://github.com/bybenb/project_BeyondTheMap.git
cd project_BeyondTheMap/sourceCode
```

### Passo 2: Criar a Base de Dados

1. Abra o **MySQL Workbench** ou similar
2. Importe o arquivo `BD Agencia de Viagens.sql`:

```sql
-- No MySQL Workbench, execute:
source "caminho/para/BD Agencia de Viagens.sql"
```

Ou, se usar linha de comando:

```bash
mysql -u root -p < "BD Agencia de Viagens.sql"
```

### Passo 3: Verificar a Connection String

No cÃ³digo, a ligaÃ§Ã£o ao banco estÃ¡ definida em cada Form (procure por `data_source`):

```csharp
string data_source = "datasource=localhost;username=root;password=;database=tripagency";
```

**Ajuste se necessÃ¡rio:**
- `localhost` â†’ IP ou hostname do servidor MySQL
- `root` â†’ seu username MySQL
- `password=` â†’ sua senha (deixe vazio se nÃ£o tiver)
- `tripagency` â†’ nome da base de dados

### Passo 4: Abrir em Visual Studio

1. Abra `ReservaDeViagens.sln` no Visual Studio
2. Clique em **Build â†’ Build Solution** (ou Ctrl+Shift+B)
3. Aguarde a compilaÃ§Ã£o
4. Pressione **F5** para executar

### Passo 5: Primeiro Login

Teste com credenciais padrÃ£o (se existirem na BD):
- Username: `admin` (ou outro definido no banco)
- Password: `123456` (ou conforme criou)

---

## ğŸ” AutenticaÃ§Ã£o Detalhada

### Login por Senha
```
1. Utilizador abre "Login com Senha"
2. Escreve username e password
3. Sistema verifica na tabela "funcionarios"
4. Se correto:
   - Regista entrada na tabela "log_acessos"
   - Abre Menu Principal
5. Se errado:
   - Mostra erro
   - Deixa tentar novamente
```

### Login por Rosto (Reconhecimento Facial)
```
1. Sistema carrega TODOS os rostos guardados do banco
2. "Ensina" o algoritmo LBPH a reconhecer cada rosto
3. CÃ¢mera ligada
4. Para cada frame do vÃ­deo:
   - Detecta caras (usando Haar Cascade)
   - Compara com rostos conhecidos
   - Calcula semelhanÃ§a (0-100)
5. Se semelhanÃ§a < 60:
   - "Encontrei! Bem-vindo [Nome]!"
   - Regista entrada e abre Menu
6. Se semelhanÃ§a > 60:
   - "NÃ£o reconheÃ§o..."
   - Continua a tentar
```

---

## ğŸ“¸ Cadastro de Rosto

Antes de fazer login com rosto, o funcionÃ¡rio precisa registar a sua cara:

```
1. Clica em "Cadastrar Rosto"
2. CÃ¢mera ligada
3. Sistema detecta automaticamente caras (retÃ¢ngulo verde)
4. Utilizador posiciona o rosto bem
5. Clica "Capturar"
6. Foto do rosto guardada no banco (como imagem JPEG)
7. PrÃ³xima vez pode fazer login apenas com rosto!
```

**Dica:** Para melhor reconhecimento:
- IluminaÃ§Ã£o boa e frente para a cÃ¢mera
- Sem Ã³culos ou chapÃ©us
- Rosto limpo (sem barba/bigode recente)

---

## ğŸ“Š Base de Dados - Tabelas Principais

| Tabela | DescriÃ§Ã£o |
|---|---|
| `funcionarios` | Dados dos funcionÃ¡rios (id, nome, username, password, etc.) |
| `clientes` | Dados dos clientes |
| `RostoFuncionario` | Foto do rosto de cada funcionÃ¡rio (blob JPEG) |
| `log_acessos` | Registro de quem entrou e quando (login/logout) |
| `viagens` | InformaÃ§Ãµes de viagens disponÃ­veis |
| `hoteis` | HotÃ©is parceiros |
| `passagens` | Companhias aÃ©reas e passagens |
| `reservas` | Reservas criadas pelos clientes |

---

## âš™ï¸ Funcionalidades Principais

### ğŸ‘¤ Cliente Pode:
- âœ… Ver perfil
- âœ… Fazer nova reserva (viagem + hotel + passagem)
- âœ… Ver histÃ³rico de reservas
- âœ… Ver histÃ³rico de acessos

### ğŸ‘¨â€ğŸ’¼ FuncionÃ¡rio Pode:
- âœ… Tudo que cliente pode
- âœ… Ver outros clientes

### ğŸ›¡ï¸ Admin Pode:
- âœ… Tudo que funcionÃ¡rio pode
- âœ… Gerir clientes (adicionar, editar, deletar)
- âœ… Gerir funcionÃ¡rios (adicionar, editar, deletar)
- âœ… Ver todos os logs de acesso
- âœ… Gerar relatÃ³rios (PDF)

---

## ğŸ› ResoluÃ§Ã£o de Problemas

### âŒ "Erro de conexÃ£o com banco de dados"
**SoluÃ§Ã£o:**
- Verifique se MySQL Server estÃ¡ a correr
- Verifique a connection string (username, password, IP)
- Verifique se base de dados `tripagency` existe

### âŒ "Arquivo haarcascade_frontalface_default.xml nÃ£o encontrado"
**SoluÃ§Ã£o:**
- Verifique se o arquivo estÃ¡ na pasta `Resources` do projeto
- Se nÃ£o estiver, copie de `sources/haarcascade_frontalface_default.xml`
- Reconstrua a soluÃ§Ã£o (Build)

### âŒ "CÃ¢mera nÃ£o funciona"
**SoluÃ§Ã£o:**
- Verifique se Windows tem permissÃ£o para cÃ¢mera (ConfiguraÃ§Ãµes â†’ Privacidade â†’ CÃ¢mera)
- Feche outras aplicaÃ§Ãµes que usem cÃ¢mera
- Reinicie a aplicaÃ§Ã£o

### âŒ "Reconhecimento facial muito lento ou impreciso"
**SoluÃ§Ã£o:**
- Melhore a iluminaÃ§Ã£o
- Aumente o nÃºmero de rostos registados para treino mais robusto
- Ajuste o threshold (valor 60) no cÃ³digo `LerRostoForm.cs` se necessÃ¡rio

---

## ğŸ“ Notas para Desenvolvedores

### SeguranÃ§a âš ï¸
- âš ï¸ **IMPORTANTE:** Connection string estÃ¡ hardcoded no cÃ³digo (NÃƒO USAR EM PRODUÃ‡ÃƒO!)
- âš ï¸ Mover para `App.config` ou variÃ¡veis de ambiente
- âš ï¸ Implementar hash de passwords (usar bcrypt, nÃ£o plain text)
- âš ï¸ Adicionar HTTPS/TLS para comunicaÃ§Ã£o

### Melhorias Futuras ğŸ’¡
- Refatorar: Centralizar queries em camada de acesso a dados (DAL)
- Melhorar UX: Feedback visual melhor (barras de progresso, contadores)
- Performance: Cache de rostos em memÃ³ria
- Teste: Adicionar testes unitÃ¡rios
- Mobile: Considerar versÃ£o web/mobile

### Estrutura de CÃ³digo Atual
```csharp
// PadrÃ£o ATUAL (disperso):
public class LoginForm : Form {
    private void btnLogin_Click(...) {
        using (MySqlConnection conn = new MySqlConnection(data_source)) {
            conn.Open();
            MySqlCommand cmd = new MySqlCommand(query, conn);
            // ... lÃ³gica aqui
        }
    }
}

// PadrÃ£o RECOMENDADO (refatorado):
public class UsuarioDAL {
    public bool ValidarCredenciais(string username, string password) {
        // Toda a lÃ³gica de BD centralizada aqui
    }
}

public class LoginForm : Form {
    private void btnLogin_Click(...) {
        UsuarioDAL dal = new UsuarioDAL();
        if (dal.ValidarCredenciais(username, password)) {
            // Abrir menu
        }
    }
}
```

---

## ğŸ“š ReferÃªncias Externas

- [Microsoft Docs - Windows Forms](https://docs.microsoft.com/en-us/dotnet/desktop/winforms/)
- [Emgu CV Documentation](https://www.emgu.com/)
- [MySQL Connector/NET](https://dev.mysql.com/doc/connector-net/en/)
- [iTextSharp Tutorial](https://itextpdf.com/)

---


## ğŸ“„ LicenÃ§a

Este projeto foi desenvolvido para fins educacionais/acadÃ©micos.

---

## ğŸ“ Suporte

Para dÃºvidas ou problemas:
1. Consulte a secÃ§Ã£o "ResoluÃ§Ã£o de Problemas" acima
2. Verifique os logs do MySQL
3. Contacte um membro da equipa

---

**Ãšltima atualizaÃ§Ã£o:** Novembro 2025  
**VersÃ£o:** 1.0
