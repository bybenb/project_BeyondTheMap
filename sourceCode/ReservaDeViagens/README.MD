# Al√©m do Mapa - Sistema de Gest√£o de Ag√™ncia de Viagens

Um aplicativo de desktop em **C# / Windows Forms** que gerencia reservas de viagens com autentica√ß√£o por senha **e reconhecimento facial** integrado.

---

##  Vis√£o Geral

Este projeto √© um sistema completo para uma ag√™ncia de viagens que permite:

-  **Autentica√ß√£o de funcion√°rios** (senha ou rosto)
-  **Cadastro de rostos** para reconhecimento facial
-  **Gest√£o de clientes e funcion√°rios** (CRUD)
-  **Cria√ß√£o e visualiza√ß√£o de reservas** (viagens, hot√©is, passagens)
-  **Hist√≥rico de acessos** (quem entrou e quando)
-  **Relat√≥rios em PDF**
-  **Painel de administrador**



##  Equipa & Cr√©ditos

- **Hernani Machado** - [@bengazai](https://www.instagram.com/bengazai/)
- **Nazar√© Sant'Ana** - [@iamnaza1](https://www.instagram.com/iamnaza1/)
- **J√∫lio Peliganga** - [@juliopelinganga](https://www.instagram.com/juliopelinganga/)
- **Jolinda Cabando**
- **David Coutinho** - [@davidcoutinho80](https://www.instagram.com/davidcoutinho80/)
- **Aldo Bruno** - [@aldo.dasilva](https://www.facebook.com/aldo.dasilva.7146/)
- **Beny Reis** - [@bkapa8](https://www.instagram.com/bkapa8/)

---


## Como Funciona (Vis√£o Simples)

### 1 **Arranque da Aplica√ß√£o**
```
App inicia ‚Üí Tela Inicial (InicioForm)
```
O utilizador v√™ op√ß√µes: Login, Cadastro, etc.

### 2 **Autentica√ß√£o por Senha**
```
Username + Password ‚Üí Banco de dados valida ‚Üí Menu Principal
```

### 3 **Autentica√ß√£o por Rosto** (O legal!)
```
a) PRIMEIRA VEZ: Cadastrar rosto
   C√¢mera liga ‚Üí Detecta a sua cara ‚Üí Guarda no banco

b) PR√ìXIMAS VEZES: Login com rosto
   C√¢mera liga ‚Üí Compara com caras guardadas ‚Üí Reconhece ‚Üí Login autom√°tico
```

### 4 **Dentro do Sistema**
- Criar reservas de viagens
- Ver hist√≥rico de reservas
- Gerar relat√≥rios (PDF)
- Admin pode gerir tudo

---

##  Como Funciona o Reconhecimento Facial

### **Fase 1: Treinamento (Setup)**
```
Sistema carrega todos os rostos guardados na BD
        ‚Üì
Converte cada rosto para preto e branco (grayscale)
        ‚Üì
Extrai padr√µes especiais de cada rosto
(usando algoritmo LBPH - Local Binary Patterns Histograms)
        ‚Üì
"Aprende" a reconhecer cada funcion√°rio
```

### **Fase 2: Reconhecimento em Tempo Real**
```
C√¢mera ligada ‚Üí Para cada fotograma:
        ‚Üì
1. Detecta caras (usando Haar Cascade XML)
2. Para cada cara encontrada:
   - Extrai apenas o rosto
   - Converte para preto e branco
   - Compara com rostos conhecidos
   - Calcula semelhan√ßa (0-100)
        ‚Üì
3. Se semelhan√ßa < 60 ‚Üí "Esta √© a cara do Jo√£o!"
   Se semelhan√ßa > 60 ‚Üí "N√£o reconhe√ßo..."
```

### **Analogia F√°cil**
Imagina um **guarda de seguran√ßa** numa discoteca:
- Primeiro, memoriza as caras dos VIPs (treinamento)
- Depois, quando algu√©m chega, olha e diz:
  - "Hmm, 95% de certeza que √© o Jo√£o" ‚Üí Entra!
  - "N√£o reconhe√ßo esta cara" ‚Üí Pede bilhete

---

##  Tecnologias Usadas

| Componente | Vers√£o | Descri√ß√£o |
|---|---|---|
| **.NET Framework** | 4.7.2 | Plataforma base |
| **Windows Forms** | Nativa | Interface gr√°fica |
| **MySQL** (XAMPP) | 9.5.0 | Banco de dados |
| **Emgu CV** | 4.4.0 | Vis√£o computacional (rosto) |
| **iTextSharp** | 5.5.13 | Gera√ß√£o de PDFs |
| **BouncyCastle** | 2.6.2 | Criptografia |

---

##  Estrutura do Projeto

```
ReservaDeViagens/
‚îú‚îÄ‚îÄ Program.cs                    # Ponto de entrada (main)
‚îú‚îÄ‚îÄ App.config                    # Configura√ß√µes
‚îú‚îÄ‚îÄ ReservaDeViagens.csproj       # Arquivo do projeto
‚îú‚îÄ‚îÄ packages.config               # Depend√™ncias NuGet
‚îÇ
‚îú‚îÄ‚îÄ Forms/                        # Telas da aplica√ß√£o
‚îÇ   ‚îú‚îÄ‚îÄ InicioForm.cs            # Tela inicial
‚îÇ   ‚îú‚îÄ‚îÄ LoginForm.cs             # Login por senha
‚îÇ   ‚îú‚îÄ‚îÄ LerRostoForm.cs          # Login por rosto (reconhecimento)
‚îÇ   ‚îú‚îÄ‚îÄ CadastrarRostoForm.cs    # Registar novo rosto
‚îÇ   ‚îú‚îÄ‚îÄ MenuForm.cs              # Menu principal
‚îÇ   ‚îú‚îÄ‚îÄ ViagemForm.cs            # Criar reserva
‚îÇ   ‚îú‚îÄ‚îÄ verReservaForm.cs        # Ver reservas
‚îÇ   ‚îú‚îÄ‚îÄ AdminClientForm.cs       # Gerir clientes (admin)
‚îÇ   ‚îú‚îÄ‚îÄ AdminFuncionarioForm.cs  # Gerir funcion√°rios (admin)
‚îÇ   ‚îú‚îÄ‚îÄ HistoricoAcessosForm.cs  # Ver logs de acesso
‚îÇ   ‚îî‚îÄ‚îÄ ... (outras forms)
‚îÇ
‚îú‚îÄ‚îÄ Resources/
‚îÇ   ‚îú‚îÄ‚îÄ haarcascade_frontalface_default.xml  # Detector de rostos (OpenCV)
‚îÇ   ‚îî‚îÄ‚îÄ logo/ imagens/
‚îÇ
‚îî‚îÄ‚îÄ bin/
    ‚îú‚îÄ‚îÄ Debug/                   # Compila√ß√£o debug
    ‚îî‚îÄ‚îÄ Release/                 # Compila√ß√£o release
```

---

##  Como Instalar e Executar

### Requisitos Pr√©vios

- **Visual Studio** 2017/2019/2022 (com suporte .NET Framework 4.7.2)
- **XAMPP** (vers√£o PHP 8.2+)
- **MySQL Workbench**
- **C√¢mera de computador** (para reconhecimento facial)

### Passo 1: Clonar/Descarregar o Projeto

Baixe agora [Aqui](https://github.com/bybenb/project_BeyondTheMap/archive/refs/heads/master.zip) ou Clonando assim:

```bash
# Se no reposit√≥rio Git
git clone https://github.com/bybenb/project_BeyondTheMap.git
cd project_BeyondTheMap/sourceCode
```

### Passo 2: Criar a Base de Dados

1. Abra o **MySQL Workbench** ou similar
2. Importe o arquivo `BD Agencia de Viagens.sql`:

```sql
-- No MySQL Workbench, execute:
source "caminho/para/BD Agencia de Viagens.sql"
```

Ou, se usar linha de comando:

```bash
mysql -u root -p < "BD Agencia de Viagens.sql"
```

### Passo 3: Verificar a Connection String

No c√≥digo, a liga√ß√£o ao banco est√° definida em cada Form (procure por `data_source`):

```csharp
string data_source = "datasource=localhost;username=root;password=;database=tripagency";
```

**Ajuste se necess√°rio:**
- `localhost` ‚Üí IP ou hostname do servidor MySQL
- `root` ‚Üí seu username MySQL
- `password=` ‚Üí sua senha (deixe vazio se n√£o tiver)
- `tripagency` ‚Üí nome da base de dados

### Passo 4: Abrir em Visual Studio

1. Abra `ReservaDeViagens.sln` no Visual Studio
2. Clique em **Build ‚Üí Build Solution** (ou Ctrl+Shift+B)
3. Aguarde a compila√ß√£o
4. Pressione **F5** para executar

### Passo 5: Primeiro Login

Teste com credenciais padr√£o (se existirem na BD):
- Username: `admin` (ou outro definido no banco)
- Password: `123456` (ou conforme criou)

---

##  Autentica√ß√£o Detalhada

### Login por Senha
```
1. Utilizador abre "Login com Senha"
2. Escreve username e password
3. Sistema verifica na tabela "funcionarios"
4. Se correto:
   - Regista entrada na tabela "log_acessos"
   - Abre Menu Principal
5. Se errado:
   - Mostra erro
   - Deixa tentar novamente
```

### Login por Rosto (Reconhecimento Facial)
```
1. Sistema carrega TODOS os rostos guardados do banco
2. "Ensina" o algoritmo LBPH a reconhecer cada rosto
3. C√¢mera ligada
4. Para cada frame do v√≠deo:
   - Detecta caras (usando Haar Cascade)
   - Compara com rostos conhecidos
   - Calcula semelhan√ßa (0-100)
5. Se semelhan√ßa < 60:
   - "Encontrei! Bem-vindo [Nome]!"
   - Regista entrada e abre Menu
6. Se semelhan√ßa > 60:
   - "N√£o reconhe√ßo..."
   - Continua a tentar
```

---

##  Cadastro de Rosto

Antes de fazer login com rosto, o funcion√°rio precisa registar a sua cara:

```
1. Clica em "Cadastrar Rosto"
2. C√¢mera ligada
3. Sistema detecta automaticamente caras (ret√¢ngulo verde)
4. Utilizador posiciona o rosto bem
5. Clica "Capturar"
6. Foto do rosto guardada no banco (como imagem JPEG)
7. Pr√≥xima vez pode fazer login apenas com rosto!
```

**Dica:** Para melhor reconhecimento:
- Ilumina√ß√£o boa e frente para a c√¢mera
- Sem √≥culos ou chap√©us
- Rosto limpo (sem barba/bigode recente)

---

## üìä Base de Dados - Tabelas Principais

| Tabela | Descri√ß√£o |
|---|---|
| `funcionarios` | Dados dos funcion√°rios (id, nome, username, password, etc.) |
| `clientes` | Dados dos clientes |
| `RostoFuncionario` | Foto do rosto de cada funcion√°rio (blob JPEG) |
| `log_acessos` | Registro de quem entrou e quando (login/logout) |
| `viagens` | Informa√ß√µes de viagens dispon√≠veis |
| `hoteis` | Hot√©is parceiros |
| `passagens` | Companhias a√©reas e passagens |
| `reservas` | Reservas criadas pelos clientes |

---

##  Funcionalidades Principais

###  Cliente Pode:
-  Ver perfil
-  Fazer nova reserva (viagem + hotel + passagem)
-  Ver hist√≥rico de reservas
-  Ver hist√≥rico de acessos

###  Funcion√°rio Pode:
-  Tudo que cliente pode
-  Ver outros clientes

###  Admin Pode:
-  Tudo que funcion√°rio pode
-  Gerir clientes (adicionar, editar, deletar)
-  Gerir funcion√°rios (adicionar, editar, deletar)
-  Ver todos os logs de acesso
-  Gerar relat√≥rios (PDF)

---

##  Resolu√ß√£o de Problemas

### 1. "Erro de conex√£o com banco de dados"
**Solu√ß√£o:**
- Verifique se MySQL Server est√° a correr
- Verifique a connection string (username, password, IP)
- Verifique se base de dados `tripagency` existe

### 2. "Arquivo haarcascade_frontalface_default.xml n√£o encontrado"
**Solu√ß√£o:**
- Verifique se o arquivo est√° na pasta `Resources` do projeto
- Se n√£o estiver, copie de `sources/haarcascade_frontalface_default.xml`
- Reconstrua a solu√ß√£o (Build)

### 3. "C√¢mera n√£o funciona"
**Solu√ß√£o:**
- Verifique se Windows tem permiss√£o para c√¢mera (Configura√ß√µes ‚Üí Privacidade ‚Üí C√¢mera)
- Feche outras aplica√ß√µes que usem c√¢mera
- Reinicie a aplica√ß√£o

### 4. "Reconhecimento facial muito lento ou impreciso"
**Solu√ß√£o:**
- Melhore a ilumina√ß√£o
- Aumente o n√∫mero de rostos registados para treino mais robusto
- Ajuste o threshold (valor 60) no c√≥digo `LerRostoForm.cs` se necess√°rio

---

## Notas para Desenvolvedores

### Seguran√ßa 
- ‚ö†Ô∏è **IMPORTANTE:** Connection string est√° hardcoded no c√≥digo (N√ÉO USAR EM PRODU√á√ÉO!)
- ‚ö†Ô∏è Mover para `App.config` ou vari√°veis de ambiente
- ‚ö†Ô∏è Implementar hash de passwords (usar bcrypt, n√£o plain text)
- ‚ö†Ô∏è Adicionar HTTPS/TLS para comunica√ß√£o

### Melhorias Futuras 
- Refatorar: Centralizar queries em camada de acesso a dados (DAL)
- Melhorar UX: Feedback visual melhor (barras de progresso, contadores)
- Performance: Cache de rostos em mem√≥ria
- Teste: Adicionar testes unit√°rios
- Mobile: Considerar vers√£o web/mobile

### Estrutura de C√≥digo Atual
```csharp
// Padr√£o ATUAL (disperso):
public class LoginForm : Form {
    private void btnLogin_Click(...) {
        using (MySqlConnection conn = new MySqlConnection(data_source)) {
            conn.Open();
            MySqlCommand cmd = new MySqlCommand(query, conn);
            // ... l√≥gica aqui
        }
    }
}

// Padr√£o RECOMENDADO (refatorado):
public class UsuarioDAL {
    public bool ValidarCredenciais(string username, string password) {
        // Toda a l√≥gica de BD centralizada aqui
    }
}

public class LoginForm : Form {
    private void btnLogin_Click(...) {
        UsuarioDAL dal = new UsuarioDAL();
        if (dal.ValidarCredenciais(username, password)) {
            // Abrir menu
        }
    }
}
```

---

##  Refer√™ncias Externas

- [Microsoft Docs - Windows Forms](https://docs.microsoft.com/en-us/dotnet/desktop/winforms/)
- [Emgu CV Documentation](https://www.emgu.com/)
- [MySQL Connector/NET](https://dev.mysql.com/doc/connector-net/en/)
- [iTextSharp Tutorial](https://itextpdf.com/)

---


##  Licen√ßa

Este projeto foi desenvolvido para fins educacionais/acad√©micos.

---

##  Suporte

Para d√∫vidas ou problemas:
1. Consulte a sec√ß√£o "Resolu√ß√£o de Problemas" acima
2. Verifique os logs do MySQL
3. Contacte um membro da equipa

---

**√öltima atualiza√ß√£o:** Novembro 2025  
**Vers√£o:** 1.0
